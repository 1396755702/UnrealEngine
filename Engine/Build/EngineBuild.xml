<?xml version='1.0' ?>
<BuildGraph xmlns="http://www.epicgames.com/BuildGraph" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.epicgames.com/BuildGraph ../../Engine/Build/Graph/Schema.xsd" >

	<Property Name="OutputDir" Value="P:\Builds\UE4" If="$(IsBuildMachine) And '$(OutputDir)' == ''"/>
	<Property Name="OutputDir" Value="$(RootDir)\LocalBuilds" If="'$(OutputDir)' == ''"/>

	<Property Name="OutputDirMac" Value="/Volumes/Builds/UE4" If="$(IsBuildMachine) And '$(OutputDirMac)' == ''"/>
	<Property Name="OutputDirMac" Value="$(RootDir)/LocalBuilds" If="'$(OutputDirMac)' == ''"/>

	<Property Name="StrippedOutput" Value="$(RootDir)\Saved"/>
	<Property Name="StrippedOutputMac" Value="$(RootDir)/Saved"/>

	<!-- Base editor and tools for compile -->
	<Agent Name="Editor Win64" Type="CompileWin64">
		<Node Name="Update Version Files">
			<Log Message="$(RootDir)"/>
			<SetVersion Change="$(Change)" Branch="$(EscapedBranch)" If="$(IsBuildMachine)"/>
		</Node>
		<Node Name="Compile UnrealHeaderTool Win64" Requires="Update Version Files">
			<Compile Target="UnrealHeaderTool" Platform="Win64" Configuration="Development" Arguments="-precompile"/>
		</Node>
		<Node Name="Compile UE4Editor Win64" Requires="Compile UnrealHeaderTool Win64" Produces="#UE4Editor Win64">
			<Compile Target="UE4Editor" Platform="Win64" Configuration="Development" Tag="#UE4Editor Win64" Arguments="-precompile"/>
		</Node>
		<!--<Node Name="Strip UE4Editor Win64" Requires="#UE4Editor Win64">
			<Tag Files="#UE4Editor Win64" Filter="*.pdb" With="#Editor_ToStrip_Win64"/>
			<Strip BaseDir="$(RootDir)" OutputDir="$(StrippedOutput)" Platform="Win64" Files="#Editor_ToStrip_Win64"/>
		</Node>-->
		<Node Name="Sign UE4Editor Win64" Requires="#UE4Editor Win64">
			<Tag Files="#UE4Editor Win64" Filter="*.exe;*.dll" With="#Editor_ToSign_Win64"/>
			<Sign Files="#Editor_ToSign_Win64"/>
		</Node>
	</Agent>
	

	<!-- Base editor and tools for compile on Mac -->
	<Agent Name="Editor Mac" Type="CompileMac">
		<Node Name="Compile UnrealHeaderTool Mac" Requires="Update Version Files">
			<Compile Target="UnrealHeaderTool" Platform="Mac" Configuration="Development" Arguments="-precompile"/>
		</Node>
		<Node Name="Compile UE4Editor Mac" Requires="Compile UnrealHeaderTool Mac" Produces="#UE4Editor Mac">
			<Compile Target="UE4Editor" Platform="Mac" Configuration="Development" Tag="#UE4Editor Mac" Arguments="-precompile"/>
		</Node>
		
		<!-- This appears to not do anything on 4.12 - leaving it out for now. 
		<Node Name="Strip UE4Editor Mac" Requires="#UE4Editor Mac">
			<Strip BaseDir="$(RootDir)" OutputDir="$(StrippedOutputMac)" Platform="Mac" Files="#UE4Editor Mac"/>
		</Node>-->
		<Node Name="Sign UE4Editor Mac" Requires="#UE4Editor Mac">
			<Log Files="#UE4Editor Mac"/>
			<Tag Files="#UE4Editor Mac" Filter="*.dylib;*.app" With="#Editor_ToSign_Mac"/>
			<Log Files="#Editor_ToSign_Mac"/>
			<Sign Files="#Editor_ToSign_Mac"/>
		</Node>
	</Agent>

	<!-- Downstream monolithics and tools Win64 -->
	<Agent Name="Monolithics Win64" Type="CompileWin64">
		<Node Name="Compile Tools Win64" Requires="Compile UnrealHeaderTool Win64;Update Version Files">
			<Compile Target="CrashReportClient" Platform="Win64" Configuration="Shipping"/>
			<Compile Target="ShaderCompileWorker" Platform="Win64" Configuration="Development"/>
			<Compile Target="UnrealLightmass" Platform="Win64" Configuration="Development"/>
			<Compile Target="UnrealPak" Platform="Win64" Configuration="Development"/>
		</Node>
		<Node Name="Compile UE4Game Win64" Requires="Compile UnrealHeaderTool Win64" Produces="#UE4Game Win64">
			<Compile Target="UE4Game" Platform="Win64" Configuration="Development" Tag="#UE4Game Win64" Arguments="-precompile"/>
			<Compile Target="UE4Game" Platform="Win64" Configuration="Shipping" Tag="#UE4Game Win64" Arguments="-precompile"/>
		</Node>
		<Node Name="Strip UE4Game Win64" Requires="#UE4Game Win64">
			<Tag Files="#UE4Game Win64" Filter="*.pdb" With="#Game_ToStrip_Win64"/>
			<Strip BaseDir="$(RootDir)" OutputDir="$(StrippedOutput)" Platform="Win64" Files="#Game_ToStrip_Win64"/>
		</Node>
		<Node Name="Sign UE4Game Win64" Requires="#UE4Game Win64">
			<Tag Files="#UE4Game Win64" Filter="*.exe;*.dll" With="#Game_ToSign_Win64"/>
			<Sign Files="#Game_ToSign_Win64"/>
		</Node>
	</Agent>

	<!-- Downstream monolithics and tools Win32 -->
	<Agent Name="Monolithics Win32" Type="CompileWin32">
		<Node Name="Compile UE4Game Win32" Requires="Compile UnrealHeaderTool Win64" Produces="#UE4Game Win32">
			<Compile Target="UE4Game" Platform="Win32" Configuration="Development" Tag="#UE4Game Win32" Arguments="-precompile"/>
			<Compile Target="UE4Game" Platform="Win32" Configuration="Shipping" Tag="#UE4Game Win32" Arguments="-precompile"/>
		</Node>
		<Node Name="Strip UE4Game Win32" Requires="#UE4Game Win32">
			<Tag Files="#UE4Game Win32" Filter="*.pdb" With="#Game_ToStrip_Win32"/>
			<Strip BaseDir="$(RootDir)" OutputDir="$(StrippedOutput)" Platform="Win32" Files="#Game_ToStrip_Win32"/>
		</Node>
		<Node Name="Sign UE4Game Win32" Requires="#UE4Game Win32">
			<Tag Files="#UE4Game Win32" Filter="*.exe;*.dll" With="#Game_ToSign_Win32"/>
			<Sign Files="#Game_ToSign_Win32"/>
		</Node>
	</Agent>

	<!-- Downstream monolithics and tools Mac -->
	<Agent Name="Monolithics Mac" Type="CompileMac">
		<Node Name="Compile Tools Mac" Requires="Compile UnrealHeaderTool Mac;Update Version Files">
			<Compile Target="CrashReportClient" Platform="Mac" Configuration="Shipping"/>
			<Compile Target="ShaderCompileWorker" Platform="Mac" Configuration="Development"/>
			<Compile Target="UnrealLightmass" Platform="Mac" Configuration="Development"/>
			<Compile Target="UnrealPak" Platform="Mac" Configuration="Development"/>
		</Node>
		<Node Name="Compile UE4Game Mac" Requires="Compile UnrealHeaderTool Mac" Produces="#UE4Game Mac">
			<Compile Target="UE4Game" Platform="Mac" Configuration="Development" Tag="#UE4Game Mac" Arguments="-precompile"/>
			<Compile Target="UE4Game" Platform="Mac" Configuration="Shipping" Tag="#UE4Game Mac" Arguments="-precompile"/>
		</Node>
		<Node Name="Strip UE4Game Mac" Requires="#UE4Game Mac">
			<Tag Files="#UE4Game Mac" Filter="*.a" With="#Game_ToStrip_Mac"/>
			<Strip BaseDir="$(RootDir)" OutputDir="$(StrippedOutputMac)" Platform="Mac" Files="#Game_ToStrip_Mac"/>
		</Node>
		<Node Name="Sign UE4Game Mac" Requires="#UE4Game Mac;Strip UE4Game Mac">
			<Tag Files="#UE4Game Mac" Filter="*.dylib;*.app" With="#Game_ToSign_Mac"/>
			<Sign Files="#Game_ToSign_Mac"/>
		</Node>
	</Agent>

	<!-- Downstream monolithics and tools Mac -->
	<Agent Name="Monolithics Linux" Type="CompileWin64">
		<Node Name="Compile Tools Linux" Requires="Compile UnrealHeaderTool Win64;Update Version Files">
			<Compile Target="CrashReportClient" Platform="Linux" Configuration="Shipping"/>
			<Compile Target="ShaderCompileWorker" Platform="Linux" Configuration="Development"/>
			<Compile Target="UnrealLightmass" Platform="Linux" Configuration="Development"/>
			<Compile Target="UnrealPak" Platform="Linux" Configuration="Development"/>
		</Node>
		<Node Name="Compile UE4Game Linux" Requires="Compile UnrealHeaderTool Win64" Produces="#UE4Game Linux">
			<Compile Target="UE4Game" Platform="Linux" Configuration="Development" Tag="#UE4Game Linux" Arguments="-precompile"/>
			<Compile Target="UE4Game" Platform="Linux" Configuration="Shipping" Tag="#UE4Game Linux" Arguments="-precompile"/>
		</Node>
		<Node Name="Strip UE4Game Linux" Requires="#UE4Game Linux">
			<Tag Files="#UE4Game Linux" Filter="Engine\Binaries\Linux\*." With="#Game_ToStrip_Linux"/>
      <Strip BaseDir="$(RootDir)" OutputDir="$(StrippedOutput)" Platform="Linux" Files="#Game_ToStrip_Linux"/>
		</Node>
	</Agent>

	<!-- Downstream monolithics and tools IOS-->
	<Agent Name="Monolithics IOS" Type="CompileMac">
		<Node Name="Compile UE4Game IOS" Requires="Compile UnrealHeaderTool Mac" Produces="#UE4Game IOS">
			<Compile Target="UE4Game" Platform="IOS" Configuration="Development" Tag="#UE4Game IOS" Arguments="-precompile"/>
			<Compile Target="UE4Game" Platform="IOS" Configuration="Shipping" Tag="#UE4Game IOS" Arguments="-precompile"/>
		</Node>
		<Node Name="Strip UE4Game IOS" Requires="#UE4Game IOS">
			<Tag Files="#UE4Game IOS" Filter="*.a" With="#Game_ToStrip_IOS"/>
			<Strip BaseDir="$(RootDir)" OutputDir="$(StrippedOutputMac)" Platform="IOS" Files="#Game_ToStrip_IOS"/>
		</Node>
	</Agent>

	<!-- Downstream monolithics and tools TVOS-->
	<Agent Name="Monolithics TVOS" Type="CompileMac">
		<Node Name="Compile UE4Game TVOS" Requires="Compile UnrealHeaderTool Mac" Produces="#UE4Game TVOS">
			<Compile Target="UE4Game" Platform="TVOS" Configuration="Development" Tag="#UE4Game TVOS" Arguments="-precompile"/>
			<Compile Target="UE4Game" Platform="TVOS" Configuration="Shipping" Tag="#UE4Game TVOS" Arguments="-precompile"/>
		</Node>
		<Node Name="Strip UE4Game TVOS" Requires="#UE4Game TVOS">
			<Tag Files="#UE4Game TVOS" Filter="*.a" With="#Game_ToStrip_TVOS"/>
			<Strip BaseDir="$(RootDir)" OutputDir="$(StrippedOutputMac)" Platform="TVOS" Files="#Game_ToStrip_TVOS"/>
		</Node>
	</Agent>

	<!-- Downstream monolithics and tools Android-->
	<Agent Name="Monolithics Android" Type="CompileWin64">
		<Node Name="Compile UE4Game Android" Requires="Compile UnrealHeaderTool Win64" Produces="#UE4Game Android">
			<Compile Target="UE4Game" Platform="Android" Configuration="Development" Tag="#UE4Game Android" Arguments="-precompile"/>
			<Compile Target="UE4Game" Platform="Android" Configuration="Shipping" Tag="#UE4Game Android" Arguments="-precompile"/>
		</Node>
		<Node Name="Strip UE4Game Android" Requires="#UE4Game Android">
			<Tag Files="#UE4Game Android" Filter="*so;*.a" With="#Game_ToStrip_Android"/>
			<Strip BaseDir="$(RootDir)" OutputDir="$(StrippedOutput)" Platform="Android" Files="#Game_ToStrip_Android"/>
		</Node>
	</Agent>

	<Agent Name="DDC Win64" Type="Win64">
		<Node Name="Build DDC Win64" Requires="Compile UE4Editor Win64;Compile Tools Win64">
			<!-- Get our temp dir -->
			<Local Name="DDCDir" Value="$(RootDir)\LocalBuilds\RocketDDC"/>
			<Local Name="HostPlatform" Value="Win64"/>
			<Local Name="SavedDir" Value="$(StrippedOutput)\Rocket\$(HostPlatform)"/>
			<Local Name="TargetPlatforms" Value="Windows+WindowsNoEditor+Android_ATC+IOS+TVOS+LinuxNoEditor+HTML5"/>
			<Local Name="FeaturePacks" Value="Templates\FP_FirstPersonBP\FP_FirstPersonBP.uproject;Templates\TP_FlyingBP\TP_FlyingBP.uproject;Templates\TP_RollingBP\TP_RollingBP.uproject;Templates\TP_SideScrollerBP\TP_SideScrollerBP.uproject;Templates\TP_ThirdPersonBP\TP_ThirdPersonBP.uproject;Templates\TP_TopDownBP\TP_TopDownBP.uproject;Templates\TP_TwinStickBP\TP_TwinStickBP.uproject;Templates\TP_VehicleBP\TP_VehicleBP.uproject;Templates\TP_PuzzleBP\TP_PuzzleBP.uproject;Templates\TP_2DSideScrollerBP\TP_2DSideScrollerBP.uproject;Templates\TP_VehicleAdvBP\TP_VehicleAdvBP.uproject"/>
			<!-- Delete all the old files -->
			<Delete Files="$(DDCDir)\..."/>

			<Tag Files="Engine\..." Except="Engine\Build\...;Engine\Extras\...;Engine\DerivedDataCache\...;
													     ...\PS4\...;...\XboxOne\...;...\EpicInternal\...;...\CarefullyRedist\...;...\NotForLicensees\...;
															 ...\NoRedist\..." With="#ToCopy"/>
			<Tag Files="Engine\Build\NotForLicensees\EpicInternal.txt" With="#ToCopy"/>
			<Tag Files="Templates\TemplateResources\..." With="#ToCopy"/>

			<Copy FromDir="$(RootDir)" ToDir="$(DDCDir)" Files="#ToCopy"/>

			<Command Name="BuildDerivedDataCache" Arguments="-TempDir=$(DDCDir) -FeaturePacks=$(FeaturePacks) -TargetPlatforms=$(TargetPlatforms) -HostPlatform=$(HostPlatform) -SavedDir=$(SavedDir)"/>
		</Node>
	</Agent>

	<Agent Name="DDC Mac" Type="Mac">
		<Node Name="Build DDC Mac" Requires="Compile UE4Editor Mac;Compile Tools Mac">
			<!-- Get our temp dir -->
			<Local Name="DDCDir" Value="$(RootDir)/LocalBuilds/RocketDDC"/>
			<Local Name="HostPlatform" Value="Mac"/>
			<Local Name="SavedDir" Value="$(StrippedOutputMac)/Rocket/$(HostPlatform)"/>
			<Local Name="TargetPlatforms" Value="Mac+MacNoEditor+Android_ATC+IOS+TVOS+HTML5"/>
			<Local Name="FeaturePacks" Value="Templates/FP_FirstPersonBP/FP_FirstPersonBP.uproject;Templates/TP_FlyingBP/TP_FlyingBP.uproject;Templates/TP_RollingBP/TP_RollingBP.uproject;Templates/TP_SideScrollerBP/TP_SideScrollerBP.uproject;Templates/TP_ThirdPersonBP/TP_ThirdPersonBP.uproject;Templates/TP_TopDownBP/TP_TopDownBP.uproject;Templates/TP_TwinStickBP/TP_TwinStickBP.uproject;Templates/TP_VehicleBP/TP_VehicleBP.uproject;Templates/TP_PuzzleBP/TP_PuzzleBP.uproject;Templates/TP_2DSideScrollerBP/TP_2DSideScrollerBP.uproject;Templates/TP_VehicleAdvBP/TP_VehicleAdvBP.uproject"/>
			<!-- Delete all the old files -->
			<Delete Files="$(DDCDir)/..."/>

			<Tag Files="Engine/..." Except="Engine/Build/...;Engine/Extras/...;Engine/DerivedDataCache/...;
													     .../PS4/...;.../XboxOne/...;.../EpicInternal/...;.../CarefullyRedist/...;.../NotForLicensees/...;
															 .../NoRedist/..." With="#ToCopy_Mac"/>
			<Tag Files="Engine/Build/NotForLicensees/EpicInternal.txt" With="#ToCopy_Mac"/>
			<Tag Files="Templates/TemplateResources/..." With="#ToCopy_Mac"/>

			<Copy FromDir="$(RootDir)" ToDir="$(DDCDir)" Files="#ToCopy_Mac"/>

			<Command Name="BuildDerivedDataCache" Arguments="-TempDir=$(DDCDir) -FeaturePacks=$(FeaturePacks) -TargetPlatforms=$(TargetPlatforms) -HostPlatform=$(HostPlatform) -SavedDir=$(SavedDir)"/>
		</Node>
	</Agent>

	<Agent Name="ToolsGroup" Type="CompileWin64">
		<Node Name="Build Tools Win64" Requires="Compile Tools Win64">
			<Command Name="CompileTools"/>
			<Compile Target="CrashReportClient" Configuration="Shipping" Platform="Win64"/>
			<Compile Target="CrashReportClient" Configuration="Shipping" Platform="Win32"/>
			<Compile Target="ShaderCompileWorker" Configuration="Development" Platform="Win64"/>
			<Compile Target="UnrealCEFSubProcess" Configuration="Development" Platform="Win32"/>
			<Compile Target="UnrealCEFSubProcess" Configuration="Development" Platform="Win64"/>
			<Compile Target="UnrealFrontend" Configuration="Development" Platform="Win64"/>
			<Compile Target="BootstrapPackagedGame" Configuration="Shipping" Platform="Win32"/>
			<Compile Target="BootstrapPackagedGame" Configuration="Shipping" Platform="Win64"/>
			<MsBuild Project="Engine\Source\Programs\UnrealSwarm\UnrealSwarm.sln" Configuration="Development" Platform="AnyCPU"/>
			<MsBuild Project="Engine\Source\Programs\UnrealDocTool\UnrealDocTool\UnrealDocTool.sln" Configuration="Development" Platform="AnyCPU"/>
			<MsBuild Project="Engine\Source\Programs\UnrealDocTool\NetworkProfiler/NetworkProfiler.sln" Configuration="Development" Platform="AnyCPU"/>
			<MsBuild Project="Engine\Source\Programs\IOS\iPhonePackager\iPhonePackager.csproj" Configuration="Development" Platform="AnyCPU" Arguments="/verbosity:minimal /target:Rebuild"/>
			<MsBuild Project="Engine\Source\Programs\IOS\DeploymentServer\DeploymentServer.csproj" Configuration="Development" Platform="AnyCPU" Arguments="/verbosity:minimal /target:Rebuild"/>
			<MsBuild Project="Engine\Source\Programs\IOS\MobileDeviceInterface\MobileDeviceInterface.csproj" Configuration="Development" Platform="AnyCPU" Arguments="/verbosity:minimal /target:Rebuild"/>
			<MsBuild Project="Engine\Source\Programs\IOS\DeploymentInterface\DeploymentInterface.csproj" Configuration="Development" Platform="AnyCPU" Arguments="/verbosity:minimal /target:Rebuild"/>
			<MsBuild Project="Engine\Source\Programs\HTML5\HTML5LaunchHelper\HTML5LaunchHelper.csproj" Configuration="Development" Platform="AnyCPU" Arguments="/verbosity:minimal /target:Rebuild"/>
		</Node>
	</Agent>

	<!--<Agent Name="ToolsGroup_Mac" Type="CompileMac">
		<Node Name="Build Tools Win64" Requires="Compile Tools Mac">
			<Compile Target="BuildPatchTool" Configuration="Development" Platform="Mac" Arguments="-clean -nobuilduht -skipactionhistory -CopyAppBundleBackToDevice -forceunity -nobuilduht -NoHotReloadFromIDE"/>
			<Compile Target="BuildPatchTool" Configuration="Development" Platform="Mac" Arguments="-generatemanifest -nobuilduht -xgeexport -nobuilduht -skipactionhistory -CopyAppBundleBackToDevice -forceunity -NoHotReloadFromIDE -ignorejunk"/>
			<Compile Target="EpicGamesBootstrapLauncher" Configuration="Shipping" Platform="Mac"/>
			<Compile Target="UnrealEngineLauncherProxy" Configuration="Shipping" Platform="Mac"/>
			<Command Name="CompileTools"/>
			<Compile Target="CrashReportClient" Configuration="Shipping" Platform="Mac"/>
			<Compile Target="ShaderCompileWorker" Configuration="Development" Platform="Mac"/>
			<Compile Target="UnrealCEFSubProcess" Configuration="Development" Platform="Mac"/>
			<Compile Target="UnrealFrontend" Configuration="Development" Platform="Mac"/>
			<Compile Target="UnrealLightmass" Configuration="Development" Platform="Mac"/>
			<Compile Target="UnrealPak" Configuration="Development" Platform="Mac"/>
			<Compile Target="UnrealVersionSelector" Configuration="Shipping" Platform="Mac"/>
			<Compile Target="BootstrapPackagedGame" Configuration="Shipping" Platform="Mac"/>
			<Compile Target="XboxOnePDBFileUtil" Configuration="Development" Platform="Mac"/>
			<Compile Target="CrashReportClient" Configuration="Shipping" Platform="Mac"/>
		</Node>
	</Agent>-->

	<Aggregate Name="Build UE4Editor Win64" Requires="Sign UE4Editor Win64;Build DDC Win64"/>
	<Aggregate Name="Build UE4Editor Mac" Requires="Sign UE4Editor Mac;Build DDC Mac"/>
	<Aggregate Name="Build UE4Game Win64" Requires="Strip UE4Game Win64;Sign UE4Game Win64"/>
	<Aggregate Name="Build UE4Game Win32" Requires="Strip UE4Game Win32;Sign UE4Game Win32"/>
	<Aggregate Name="Build UE4Game Mac" Requires="Strip UE4Game Mac;Sign UE4Game Mac"/>
	<Aggregate Name="Build UE4Game Linux" Requires="Strip UE4Game Linux"/>
	<Aggregate Name="Build UE4Game IOS" Requires="Strip UE4Game IOS"/>
	<Aggregate Name="Build UE4Game TVOS" Requires="Strip UE4Game TVOS"/>
	<Aggregate Name="Build UE4Game Android" Requires="Strip UE4Game Android"/>

	<Aggregate Name="Monolithics" Requires="Build UE4Editor Win64;Build UE4Editor Mac;Build UE4Game Win64;Build UE4Game Mac;Build UE4Game Linux;Build UE4Game IOS;Build UE4Game TVOS;Build UE4Game Android"/>
  
	<Aggregate Name="ChadTestJob" Requires="Build Tools Win64"/>
	
	<!-- Email settings -->
	<Local Name="AllNodes" Value="Compile UE4Editor Win64;Compile UE4Editor Mac;Compile UE4Game Win64;Compile UE4Game Mac"/>
	<Notify Targets="$(AllNodes)" Submitters=".../Build/...;.../Source/..." />
</BuildGraph>
